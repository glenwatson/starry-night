"undefined"==typeof rison&&(window.rison={}),rison.uri_ok={"~":!0,"!":!0,"*":!0,"(":!0,")":!0,"-":!0,_:!0,".":!0,",":!0,":":!0,"@":!0,$:!0,"'":!0,"/":!0},function(){for(var r=[],e=0;16>e;e++)for(var n=0;16>n;n++)if(e+n!=0){var t=String.fromCharCode(16*e+n);/\w|[-_.\/~]/.test(t)||r.push("\\u00"+e.toString(16)+n.toString(16))}rison.not_idchar=r.join("")}(),rison.not_idchar=" '!:(),*@$",rison.not_idstart="-0123456789",function(){var r="[^"+rison.not_idstart+rison.not_idchar+"][^"+rison.not_idchar+"]*"
rison.id_ok=RegExp("^"+r+"$"),rison.next_id=RegExp(r,"g")}(),rison.quote=function(r){return/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(r)?r:encodeURIComponent(r).replace("%2C",",","g").replace("%3A",":","g").replace("%40","@","g").replace("%24","$","g").replace("%2F","/","g").replace("%20","+","g")},function(){var r={"'":!0,"!":!0},e={array:function(r){var n,t,i,o,s=["!("],a=r.length
for(i=0;a>i;i+=1)o=r[i],t=e[typeof o],t&&(o=t(o),"string"==typeof o&&(n&&(s[s.length]=","),s[s.length]=o,n=!0))
return s[s.length]=")",s.join("")},"boolean":function(r){return r?"!t":"!f"},"null":function(){return"!n"},number:function(r){return isFinite(r)?(r+"").replace(/\+/,""):"!n"},object:function(r){if(r){if(r instanceof Array)return e.array(r)
if("object"==typeof r.__prototype__&&void 0!==r.__prototype__.encode_rison)return r.encode_rison()
var n,t,i,o,s,a=["("],u=[]
for(i in r)u[u.length]=i
for(u.sort(),s=0;s<u.length;s++)i=u[s],o=r[i],t=e[typeof o],t&&(o=t(o),"string"==typeof o&&(n&&(a[a.length]=","),a.push(e.string(i),":",o),n=!0))
return a[a.length]=")",a.join("")}return"!n"},string:function(e){return""==e?"''":rison.id_ok.test(e)?e:(e=e.replace(/(['!])/g,function(e,n){return r[n]?"!"+n:n}),"'"+e+"'")},undefined:function(){throw Error("rison can't encode the undefined value")}}
rison.encode=function(r){return e[typeof r](r)},rison.encode_object=function(r){if("object"!=typeof r||null===r||r instanceof Array)throw Error("rison.encode_object expects an object argument")
var n=e[typeof r](r)
return n.substring(1,n.length-1)},rison.encode_array=function(r){if(!(r instanceof Array))throw Error("rison.encode_array expects an array argument")
var n=e[typeof r](r)
return n.substring(2,n.length-1)},rison.encode_uri=function(r){return rison.quote(e[typeof r](r))}}(),rison.decode=function(r){var e=function(r){throw Error("rison decoder error: "+r)},n=new rison.parser(e)
return n.parse(r)},rison.decode_object=function(r){return rison.decode("("+r+")")},rison.decode_array=function(r){return rison.decode("!("+r+")")},rison.parser=function(r){this.errorHandler=r},rison.parser.WHITESPACE="",rison.parser.prototype.setOptions=function(r){r.errorHandler&&(this.errorHandler=r.errorHandler)},rison.parser.prototype.parse=function(r){this.string=r,this.index=0,this.message=null
var e=this.readValue()
return!this.message&&this.next()&&(e=this.error("unable to parse string as rison: '"+rison.encode(r)+"'")),this.message&&this.errorHandler&&this.errorHandler(this.message,this.index),e},rison.parser.prototype.error=function(r){return"undefined"!=typeof console&&console.log("rison parser error: ",r),void(this.message=r)},rison.parser.prototype.readValue=function(){var r=this.next(),e=r&&this.table[r]
if(e)return e.apply(this)
var n=this.string,t=this.index-1
rison.next_id.lastIndex=t
var i=rison.next_id.exec(n)
if(i.length>0){var o=i[0]
return this.index=t+o.length,o}return this.error(r?"invalid character: '"+r+"'":"empty expression")},rison.parser.parse_array=function(r){for(var e,n=[];")"!=(e=r.next());){if(!e)return r.error("unmatched '!('")
if(n.length)","!=e&&r.error("missing ','")
else{if(","==e)return r.error("extra ','");--r.index}var t=r.readValue()
if(void 0===t)return void 0
n.push(t)}return n},rison.parser.bangs={t:!0,f:!1,n:null,"(":rison.parser.parse_array},rison.parser.prototype.table={"!":function(){var r=this.string,e=r.charAt(this.index++)
if(!e)return this.error('"!" at end of input')
var n=rison.parser.bangs[e]
return"function"==typeof n?n.call(null,this):void 0===n?this.error('unknown literal: "!'+e+'"'):n},"(":function(){for(var r,e={},n=0;")"!=(r=this.next());){if(n)","!=r&&this.error("missing ','")
else{if(","==r)return this.error("extra ','");--this.index}var t=this.readValue()
if(void 0===t)return void 0
if(":"!=this.next())return this.error("missing ':'")
var i=this.readValue()
if(void 0===i)return void 0
e[t]=i,n++}return e},"'":function(){for(var r,e=this.string,n=this.index,t=n,i=[];"'"!=(r=e.charAt(n++));){if(!r)return this.error('unmatched "\'"')
if("!"==r){if(n-1>t&&i.push(e.slice(t,n-1)),r=e.charAt(n++),!("!'".indexOf(r)>=0))return this.error('invalid string escape: "!'+r+'"')
i.push(r),t=n}}return n-1>t&&i.push(e.slice(t,n-1)),this.index=n,1==i.length?i[0]:i.join("")},"-":function(){var r=this.string,e=this.index,n=e-1,t="int",i="-",o={"int+.":"frac","int+e":"exp","frac+e":"exp"}
do{var s=r.charAt(e++)
if(!s)break
s>="0"&&"9">=s||(i.indexOf(s)>=0?i="":(t=o[t+"+"+s.toLowerCase()],"exp"==t&&(i="-")))}while(t)
return this.index=--e,r=r.slice(n,e),"-"==r?this.error("invalid number"):+r}},function(r){for(var e=0;9>=e;e++)r[e+""]=r["-"]}(rison.parser.prototype.table),rison.parser.prototype.next=function(){var r=this.string,e=this.index
do{if(e==r.length)return void 0
var n=r.charAt(e++)}while(rison.parser.WHITESPACE.indexOf(n)>=0)
return this.index=e,n}